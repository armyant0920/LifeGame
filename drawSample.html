<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="style/panel.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>life game test</title>
    <script src="../js/jquery.js"></script>
</head>

<body>
    <div style="text-align: center;">

        <table id='mytable'>

        </table>

        <div class="inline">
            <button id='btn_previous' onclick="previousAct()" style="font-size: large;"></button>
            <button id='btn_play' onclick="playAction()" style="font-size: large;"></button>
            <button id='btn_next' onclick="nextAction()"></button>

            <button id='speedDown' onclick='speeddownAct()' style="font-size: large;"></button>
            <button id='speedUp' onclick='speedUpAct()' style="font-size: large;"></button>
            <div id='showSpeed' style="font-size: large;"></div>

        </div>

        <div id='hint' onmouseover="showThis(this);" onmouseout="hideThis(this);"
            style="width:auto;height:auto;border:solid 1px #a1bece;position:absolute;z-index:10000;display:none;background-color:#EEF7EA;font-size: large;">
            <p></p>
        </div>
    </div>
    <script>
        var playing = false;
        var speed = 3 * 1000;
        var Timer = null;
        var blockArr, birthArr = [], dyingArr = [];


        var activate = false;//æ»‘é¼ æ˜¯å¦å•Ÿå‹•
        var records = [];

        var up = -4, left = -4, right = 4, button = 4;

        var playTxt = " â–¶", pauseTxt = "â¸", speedUP = 'ğŸ”º', speedDown = 'ğŸ”»', previousTxt = "âª", nextTxt = "â©";

        var btn_previous = document.getElementById('btn_previous');

        var btn_next = document.getElementById('btn_next');




        function play() {

            step1();
            step2();

        }
        //èª¿æ•´é€Ÿåº¦
        function speeddownAct() {
            console.log('speedDown');
            if (speed < 10 * 1000) {
                speed += 1000;
            }
            showSpeed.innerText = `ç›®å‰é€Ÿåº¦ç‚º${speed}ms`
            if (playing) {
                resetTimer();
            }

        }
        function speedUpAct() {
            console.log('speedUp');
            if (speed > 1 * 1000) {
                speed -= 1000;

            }
            showSpeed.innerText = `ç›®å‰é€Ÿåº¦ç‚º${speed}ms`
            if (playing) {
                resetTimer();
            }
        }
        //é‡ç½®è¨ˆæ™‚å™¨
        function resetTimer() {
            if (Timer != null) {
                window.clearInterval(Timer);

            }
            Timer = setInterval(play, speed);

        }

        $(document).on('mouseover', '.block', function () {

            showHint(this);



        })


        $(document).on('click', '.block', function () {


            //åˆ‡æ›å•Ÿå‹•ç‹€æ…‹
            activate = !activate;


            console.log('activate=' + activate);


            // console.log('this td='+$(this).getAttribute("data-value"));
        });

        //step1æ ¹æ“šè¨ˆç®—çµæœéš¨æ™‚æ›´æ–°topã€leftã€rightã€button
        //ä¸¦å°‡birth&dyingçš„åº§æ¨™å„²å­˜åœ¨é™£åˆ—ä¸­,
        //step2å‰‡ä¾æ“šæ–°çš„top~buttonç¹ªè£½æ–°çš„è¡¨æ ¼,
        //ä¸¦åœ¨è¿´åœˆä¸­åˆ¤å®šç›®å‰çš„åº§æ¨™æ˜¯å¦ç¬¦åˆbirth or 

        //å…ˆæ‹¼æ¥å‡ºxã€yåº§æ¨™æ–‡å­—
        //if(dyingArr.includes('æ­»äº¡åº§æ¨™')){}
        //if(birthArr.includes('æ­»äº¡åº§æ¨™')){}

        $(document).on('mouseover', '.block', function () {


            if (activate) {
                let pick = $(this);

                if (pick.attr('pick') == 'true') {

                    die(pick);

                } else {

                    birth(pick);

                }

            }
        });

        function showHint(obj) {
            console.log('showhint')
            var top = $(obj).offset().top;
            var left = $(obj).offset().left + $(obj).width() - 7;
            // $('hint').children('p').text($(obj).attr('pos'));

            document.getElementById('hint').innerHTML = $(obj).attr('pos');
            console.log('pos=' + $(obj).attr('pos'));
            $("#hint").css({ 'top': top + "px", 'left': left + "px" }).show("fast");
        }

        function showThis(obj) {
            $(obj).show();
        }
        /*éš±è—æµ®å‹•æ¡†*/
        function hideHint() {
            $("#editCourseDiv").hide();
        }
        function hideThis(obj) {
            $(obj).hide();
        }





        function playAction() {
            console.log('playAction');
            if (playing) {
                if (Timer != null) {
                    window.clearInterval(Timer);
                    Timer = null;
                }


                playing = false;
                btn_play.innerText = playTxt;
                console.log('pause');

            } else {

                playing = true;
                Timer = setInterval(play, speed);
                btn_play.innerText = pauseTxt;
                console.log('unpause');

            }
        }


        function init() {

            btn_play.innerText = playTxt;
            btn_previous.innerText = previousTxt;
            btn_next.innerText = nextTxt;
            document.getElementById('speedDown').innerText = speedDown;
            document.getElementById('speedUp').innerText = speedUP;
            showSpeed.innerText = `ç›®å‰é€Ÿåº¦ç‚º${speed}ms`;

            // Timer = setInterval(play, speed);

            let tableStr = "";

            rendTable();



        }
        init();

        function rendTable() {

            blockArr = [];

            let tableStr = "";

            $('#mytable').empty();
            for (let y = up; y <= button; y++) {
                tableStr += "<tr>";
                for (let x = left; x <= right; x++) {

                    tempPos = "\"X:" + x + "|Y:" + y + "\"";
                    blockArr.push(tempPos);


                    if (birthArr.includes(tempPos)) {

                        tableStr += "<td class='block' pos=" + tempPos + " pick='true' style='background-color: green;'></td>";

                    } else {

                        tableStr += "<td class='block' pos=" + tempPos + " pick='false'></td>";


                    }

                }
                tableStr += "</tr>";


            }

            records.push(tableStr);//å¦‚æœåªéœ€è¦ç¹ªè¡¨,ä¹Ÿè¨±å­˜å­—ä¸²å°±å¤ äº†?

            $('#mytable').append(tableStr);


        }


        //åˆå§‹å€¼è¨­å®š->æ£‹æ ¼ä¸­æ¨™è¨»ç”Ÿå‘½éŠæˆ²çš„èµ·å§‹é»

        //ç”±æ–¼å–®ä¸€æ ¼å­çš„ç‹€æ…‹æœƒèˆ‡å…¶ä»–æ ¼å­é€£å‹•,æ•…å¿…é ˆæŠŠæ¯å›åˆåˆ¤æ–·çš„çµæœå…ˆæš«å­˜,
        //ç­‰åˆ°å…¨éƒ¨æ ¼å­éƒ½åˆ¤æ–·å®Œå¾Œ,å†ä¸€æ¬¡æŠŠæ‰€æœ‰æ ¼å­ç‹€æ…‹æ›´æ–°



        function step1() {
            //æ›´æ–°æ¯å€‹æ ¼å­çš„æš«å­˜ç‹€æ…‹

            dyingArr = [];
            birthArr = [];

            //ç”±æ–¼å¢ç”Ÿç¯„åœåªæœƒåœ¨ç¾æœ‰ç¯„åœçš„åŸºç¤ä¸‹+1,æ‰€ä»¥æŠŠæª¢æŸ¥ç¯„åœè¨­å®šç‚ºY-1~Y+1/X-1~+X+1
            // let tempMinX;
            // let tempMaxX;
            // let tempMinY;
            // let tempMaxY;

            for (let y = up - 1; y <= button + 1; y++) {

                for (let x = left - 1; x <= right + 1; x++) {
                    //å°‡ç•¶å‰åº§æ¨™å‚³å…¥æª¢æŸ¥æ–¹æ³•
                    let temp = "\"X:" + x + "|Y:" + y + "\"";

                    let result = checkTemp(temp);

                    if (result.birth) {

                        if (result.posX < left) {
                            left = result.posX;
                        }
                        if (result.posX > right) {
                            right = result.posX;
                        }

                        if (result.posY < up) {
                            up =result.posY;
                        }

                        if (result.posY > button) {
                            button = result.posY;
                        }



                    }

                    // if(tempMinX=null){
                    //     tempMinX=result.posX;
                    // }

                    // if(tempMaxX=null){
                    //     tempMaxX=result.posX;
                    // }

                    // if(tempMinY=null){
                    //     tempMinY=result.posY;
                    // }

                    // if(tempMaxY=null){
                    //     tempMaxY=result.posY;
                    // }


                    // if(result.posX<tempMinX){
                    //     tempMinX=result.posX;
                    // }else if(result.posX>tempMaxX){
                    //     tempMaxX=result.posX;
                    // }

                    // if(result.posY<tempMinY){
                    //     tempMinY=result.posY;
                    // }else if(result.posY>tempMaxY)
                    //    { tempMaxY=result.posY;
                    // }

                }


            }


        }



        function previousAct() {
            //åŸå‰‡ä¸Šæ‡‰è©²å¯ä»¥æŠŠå‰å¹¾è¼ªçš„çµæœå­˜èµ·ä¾†,å¦‚æœç©å®¶éœ€è¦çš„è©±å¯ä»¥å›æº¯

            $('#mytable').empty();

            $('#mytable').append(records.pop());

        }

        function nextAction() {

            step1();
            step2();
        }

        //è‡ªå‹•æ“´å¼µç‰ˆåœ–æ§‹æƒ³:
        //åˆå§‹åº§æ¨™ä¸­å¿ƒé»(0,0) å‘¨é­å¾(-1,-1)~(1,1)
        //åŸå‰‡ä¸Šæ“´å¼µä¸€æ¬¡æœ€å¤šä¸Šä¸‹å·¦å³å„æ–°å¢1æ’,
        //æœ€å·æ‡¶çš„æ–¹å¼æ˜¯,4å‘¨åœç›´æ¥éƒ½å¢åŠ ä¸€æ’

        function checkTemp(b) {

            console.log('b=' + b);
            let birth = false;
            let posX = parseInt(b.slice(b.indexOf('X:') + 2, b.indexOf('|')));
            let posY = parseInt(b.slice(b.indexOf('Y:') + 2));

            let yStart = -1, yEnd = 1;
            let xStart = -1, xEnd = 1;
            let count = 0;//åŸºæº–é»å‘¨åœæ ¼å­åˆ¤æ–·è¨ˆæ•¸


            console.log('xstart=' + xStart);
            console.log('xend=' + xEnd);
            console.log('ystart=' + yStart);
            console.log('yend=' + yEnd);

            for (let i = posX + xStart; i <= posX + xEnd; i++) {
                for (let j = posY + yStart; j <= posY + yEnd; j++) {

                    let current = "\"X:" + i + "|Y:" + j + "\"";

                    let temp = $('td[pos=' + current + ']');

                    //åˆ¤æ–·tempæ ¼å­æ˜¯å¦å·²å­˜åœ¨,ä»¥åŠæ˜¯å¦æ˜¯æ­£åœ¨æª¢æŸ¥çš„æ ¼å­
                    if (temp != null && current != b) {

                        if (temp.attr('pick') == 'true') {
                            count += 1;

                        }


                    } else {
                        continue;
                    }


                }
            }
            console.log(b + 'è¨ˆç®—count:' + count);




            //åŸºæœ¬è¦å‰‡
            /*æ¯å€‹ç´°èƒæœ‰å…©ç¨®ç‹€æ…‹ - å­˜æ´»æˆ–æ­»äº¡ï¼Œæ¯å€‹ç´°èƒèˆ‡ä»¥è‡ªèº«ç‚ºä¸­å¿ƒçš„å‘¨åœå…«æ ¼ç´°èƒç”¢ç”Ÿäº’å‹•ï¼ˆå¦‚åœ–ï¼Œé»‘è‰²ç‚ºå­˜æ´»ï¼Œç™½è‰²ç‚ºæ­»äº¡ï¼‰
    ç•¶å‰ç´°èƒç‚ºå­˜æ´»ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœçš„å­˜æ´»ç´°èƒä½æ–¼2å€‹æ™‚ï¼ˆä¸åŒ…å«2å€‹ï¼‰ï¼Œè©²ç´°èƒè®Šæˆæ­»äº¡ç‹€æ…‹ã€‚ï¼ˆæ¨¡æ“¬ç”Ÿå‘½æ•¸é‡ç¨€å°‘ï¼‰
    ç•¶å‰ç´°èƒç‚ºå­˜æ´»ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœæœ‰2å€‹æˆ–3å€‹å­˜æ´»ç´°èƒæ™‚ï¼Œè©²ç´°èƒä¿æŒåŸæ¨£ã€‚
    ç•¶å‰ç´°èƒç‚ºå­˜æ´»ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœæœ‰è¶…é3å€‹å­˜æ´»ç´°èƒæ™‚ï¼Œè©²ç´°èƒè®Šæˆæ­»äº¡ç‹€æ…‹ã€‚ï¼ˆæ¨¡æ“¬ç”Ÿå‘½æ•¸é‡éå¤šï¼‰
    ç•¶å‰ç´°èƒç‚ºæ­»äº¡ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœæœ‰3å€‹å­˜æ´»ç´°èƒæ™‚ï¼Œè©²ç´°èƒè®Šæˆå­˜æ´»ç‹€æ…‹ã€‚ï¼ˆæ¨¡æ“¬ç¹æ®–ï¼‰*/

            //
            //ç•¶åŸºæº–é»ç´°èƒç‚ºfalseæ™‚


            //å…ˆæª¢æŸ¥é€™å€‹æ ¼å­æ˜¯å¦å·²ç¶“å­˜åœ¨

            //å¦‚æœå·²å­˜åœ¨
            if (blockArr.includes(b)) {

                let block = $('td[pos=' + b + ']');




                if (block.attr('pick') == 'false') {

                    if (count == 3) {
                        //ç•¶å‰ç´°èƒç‚ºæ­»äº¡ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœæœ‰3å€‹å­˜æ´»ç´°èƒæ™‚ï¼Œè©²ç´°èƒè®Šæˆå­˜æ´»ç‹€æ…‹ã€‚ï¼ˆæ¨¡æ“¬ç¹æ®–ï¼‰*/
                        birth = true;
                        birthArr.push(b);
                        console.log('birthArråŠ å…¥' + b);
                    }




                }

                if (block.attr('pick') == 'true') {

                    if (count < 2) {
                        //ç•¶å‰ç´°èƒç‚ºå­˜æ´»ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœçš„å­˜æ´»ç´°èƒä½æ–¼2å€‹æ™‚ï¼ˆä¸åŒ…å«2å€‹ï¼‰ï¼Œè©²ç´°èƒè®Šæˆæ­»äº¡ç‹€æ…‹ã€‚ï¼ˆæ¨¡æ“¬ç”Ÿå‘½æ•¸é‡ç¨€å°‘ï¼‰
                        // dyingArr.push(b);
                        // console.log('dyingArråŠ å…¥' + b);
                    } else if (count <= 3) {
                        //ç•¶å‰ç´°èƒç‚ºå­˜æ´»ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœæœ‰2å€‹æˆ–3å€‹å­˜æ´»ç´°èƒæ™‚ï¼Œè©²ç´°èƒä¿æŒåŸæ¨£ã€‚
                        birth = true;
                        birthArr.push(b);
                    } else {
                        //ç•¶å‰ç´°èƒç‚ºå­˜æ´»ç‹€æ…‹æ™‚ï¼Œç•¶å‘¨åœæœ‰è¶…é3å€‹å­˜æ´»ç´°èƒæ™‚ï¼Œè©²ç´°èƒè®Šæˆæ­»äº¡ç‹€æ…‹ã€‚ï¼ˆæ¨¡æ“¬ç”Ÿå‘½æ•¸é‡éå¤šï¼‰
                        // dyingArr.push(b);
                        // console.log('dyingArråŠ å…¥' + b);

                    }
                }




            } else {

                if (count == 3) {

                    birth = true;

                    birthArr.push(b);
                    console.log('birthArråŠ å…¥' + b);
                

                }

            }

            return { 'posX': posX, 'posY': posY, 'birth': birth };

        }

        function step2() {

            rendTable();


        }

        function birth(b) {

            let t = $(b);

            t.attr('pick', 'true');
            t.css("background-color", "green");

            // console.log(t.attr('pos') + " is birth");

        }



        function die(b) {

            $(b).attr('pick', 'false');
            $(b).css("background-color", "");

            // console.log($(b).attr('pos') + " is dying");

        }


        //ç‹€æ…‹åˆ¥: state:0=death,1=alive
        //æš«å­˜ç‹€æ…‹ temp:0=dying,1=birth 

        //å›åˆé–‹å§‹æ™‚
        //1.å…ˆé€ä¸€æƒç„æ‰€æœ‰æ ¼å­state,æŠŠçµæœå­˜æˆtemp
        //*å¦‚æœtempçš„çµæœæœƒæ”¹è®Šåœ°åœ–é‚Šç•Œ,å°‡top,left,right,downæ›´æ–°
        //åŸæœ¬ä¸å­˜åœ¨çš„æ ¼å­
        //2.æ ¹æ“štempå€¼æ›´æ–°state,


        //å›åˆé–‹å§‹:step1:é€ä¸€åˆ¤å®šæ¯å€‹æ ¼å­å‘¨åœ8å€‹æ ¼å­çš„ç‹€æ…‹,ä¸¦å°‡åˆ¤æ–·çµæœå„²å­˜ç‚º


    </script>

</body>

</html>